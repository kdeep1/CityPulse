generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        Int       @id @default(autoincrement())
  username  String    @unique
  password  String
  firstName String
  lastName  String
  createdAt DateTime  @default(now())
  email     String    @unique
  role      userRole  @default(USER)
  updatedAt DateTime  @updatedAt
  bookings  Booking[]
  events    Events[]
  tickets   Ticket[] 
  favorites Favorite[] 
  payments   Payment[]
  reviews Review[] 
  @@index([role])
}

model Events {
  id            Int           @id @default(autoincrement())
  title         String
  description   String
  category      EventCategory
  startDateTime DateTime
  endDateTime   DateTime
  city          String
  address       String?
  isOnline      Boolean       @default(false)
  onlineLink    String?
  totalTickets  Int
  soldTickets   Int           @default(0)
  status        EventStatus   @default(DRAFT)
  isApproved    Boolean       @default(false)
  organizerId   Int
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  venueId       Int
  bookings      Booking[]
  eventSeats    EventSeat[]
  tickets      Ticket[] 
  reviews Review[]
  favorites Favorite[] 
  organizer     User          @relation(fields: [organizerId], references: [id])
  venue         Venue         @relation(fields: [venueId], references: [id])

  @@index([organizerId])
  @@index([status])
  @@index([category])
}

model Venue {
  id          Int       @id @default(autoincrement())
  name        String
  city        String
  address     String
  type        VenueType
  capacity    Int
  isAvailable Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  events      Events[]
  seats       Seat[]

  @@index([city])
  @@index([type])
}

model Seat {
  id         String      @id @default(uuid())
  seatType   SeatType
  venueId    Int
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  eventSeats EventSeat[]
  venue      Venue       @relation(fields: [venueId], references: [id])
}

model EventSeat {
  id        String     @id @default(uuid())
  eventId   Int
  seatId    String
  bookingId String?
  status    SeatStatus @default(AVAILABLE)
  lockedAt  DateTime?
  bookedAt  DateTime?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  booking   Booking?   @relation(fields: [bookingId], references: [id])
  event     Events     @relation(fields: [eventId], references: [id])
  seat      Seat       @relation(fields: [seatId], references: [id])
   tickets    Ticket?

  @@unique([eventId, seatId])
}

model Booking {
  id          String        @id @default(uuid())
  userId      Int
  eventId     Int
  status      BookingStatus @default(PENDING_PAYMENT)
  totalAmount Int
  currency    String        @default("INR")
  expiresAt   DateTime?
  confirmedAt DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  event       Events        @relation(fields: [eventId], references: [id])
  user        User          @relation(fields: [userId], references: [id])
  eventSeats  EventSeat[]
   tickets    Ticket[] 
 payments     Payment[] 
  @@index([userId])
  @@index([eventId])
  @@index([status])
}

enum userRole {
  USER
  ADMIN
  ORGANIZER
}

enum EventStatus {
  DRAFT
  PENDING
  APPROVED
  REJECTED
  CANCELLED
  COMPLETED
}

enum EventCategory {
  MUSIC
  SPORTS
  TECH
  ART
  BUSINESS
  EDUCATION
  OTHER
}

enum VenueType {
  THEATER
  STADIUM
  HALL
  CONFERENCE_CENTER
  OPEN_GROUND
  OTHER
}

enum SeatType {
  REGULAR
  VIP
  BALCONY
}

enum SeatStatus {
  AVAILABLE
  LOCKED
  BOOKED
}

enum BookingStatus {
  PENDING_PAYMENT
  CONFIRMED
  CANCELLED
  EXPIRED
}
model Ticket {
  id            String        @id @default(uuid())
  bookingId     String
  eventSeatId   String
  userId        Int
  eventId       Int
  booking       Booking       @relation(fields: [bookingId], references: [id])
  eventSeat     EventSeat     @relation(fields: [eventSeatId], references: [id])
  user          User          @relation(fields: [userId], references: [id])
  event         Events        @relation(fields: [eventId], references: [id])
  ticketCode    String        @unique
  qrCodeData    String        @unique
  status        TicketStatus  @default(ISSUED)
  issuedAt      DateTime      @default(now())
  scannedAt     DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  @@index([bookingId])
  @@index([eventId])
  @@index([userId])
  @@index([status])
  @@unique([eventSeatId])
}
enum TicketStatus {
  ISSUED
  SCANNED
  CANCELLED
  EXPIRED
}
model Review {
  id        String   @id @default(uuid())

  userId    Int
  eventId   Int

  user      User     @relation(fields: [userId], references: [id])
  event     Events   @relation(fields: [eventId], references: [id])

  rating    Int
  comment   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, eventId])
  @@index([eventId])
  @@index([rating])
}
model Favorite {
  id        String   @id @default(uuid())
  userId    Int
  eventId   Int
  user      User     @relation(fields: [userId], references: [id])
  event     Events   @relation(fields: [eventId], references: [id])
  createdAt DateTime @default(now())
  @@unique([userId, eventId])
  @@index([eventId])
}
model Payment {
  id                String         @id @default(uuid())

  bookingId         String
  userId            Int

  booking           Booking        @relation(fields: [bookingId], references: [id])
  user              User           @relation(fields: [userId], references: [id])

  amount            Int
  currency          String         @default("INR")

  status            PaymentStatus  @default(CREATED)
  gateway           PaymentGateway

  gatewayOrderId    String?
  gatewayPaymentId String?
  gatewaySignature String?

  failureReason     String?
  refundedAt        DateTime?

  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  completedAt       DateTime?

  @@index([bookingId])
  @@index([userId])
  @@index([status])
  @@index([gateway])
}
enum PaymentStatus {
  CREATED
  PROCESSING
  SUCCESS
  FAILED
  REFUNDED
}

enum PaymentGateway {
  RAZORPAY
  STRIPE
  PAYTM
}




